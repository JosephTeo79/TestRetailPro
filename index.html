<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Retail Pro Prism</title>
<style>
  #bot-iframe { position:fixed; bottom:20px; right:20px; width:400px; height:500px; border:1px solid #ccc; border-radius:8px; z-index:999; }
</style>
</head>
<body>

<h1>Retail Pro Prism</h1>

<iframe id="bot-iframe"></iframe>

<script>
const botIframe = document.getElementById('bot-iframe');
let botLoaded = false;

function buildBotUrl() {
  // Botpress shareable.html + 配置
  return 'https://cdn.botpress.cloud/webchat/v3.5/shareable.html' +
         '?configUrl=https://files.bpcontent.cloud/2025/12/22/00/20251222001942-XSX123E9.json';
}

function openBotAndTrigger() {
  if (!botLoaded) {
    botIframe.src = buildBotUrl();
    botLoaded = true;

    // 等 iframe 加载完成后触发 payload
    botIframe.onload = () => {
      // 用 postMessage 通知 iframe 触发 trigger
      botIframe.contentWindow.postMessage({
        type: 'trigger',
        trigger: 'submain_form',
        payload: {
          page: 'Retail Pro Prism',
          module: 'FrontOffice',
          userName: 'Joseph Teo',
          userEmail: 'hai2022my@gmail.com'
        }
      }, '*');
    };
  }
  botIframe.style.display = 'block';
}

// 打开网页立即触发
window.addEventListener('DOMContentLoaded', openBotAndTrigger);
</script>

</body>
</html>
