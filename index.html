<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Botpress Botbassador Demo</title>
</head>
<body>

<h1>Botpress Botbassador Demo</h1>

<form id="myform">
  <label>Name:</label><input type="text" name="name" required>
  <label>Email:</label><input type="email" name="email" required>
  <button type="submit">Submit</button>
</form>

<script src="https://cdn.botpress.cloud/webchat/v3.5/inject.js"></script>
<script>
  // --- 1️⃣ Init Botpress on page load ---
  window.botpressWebChat.init({
    botId: "a513dc7b-a61b-4a0e-b0c2-79292f0f64b8",
    clientId: "a77753bd-2319-48dd-a782-9d6ba282b204",
    hostUrl: "https://cdn.botpress.cloud/webchat/v3.5",
    messagingUrl: "https://messaging.botpress.cloud",
    hideWidget: true,
    lazySocket: true,
    useSessionStorage: true
  });

  window.botpressWebChat.isReady = false;

  // --- 2️⃣ Listen for bot ready ---
  window.botpressWebChat.onEvent((event) => {
    if(event.type === 'LIFECYCLE.READY'){
      window.botpressWebChat.isReady = true;
      console.log('Botpress Ready');
    }
  });

  // --- 3️⃣ Form submit ---
  document.getElementById('myform').addEventListener('submit', function(e){
    e.preventDefault();

    const detail = {
      name: this.name.value,
      email: this.email.value,
      position: "Botbassador"
    };

    // Show bot
    window.botpressWebChat.sendEvent({ type: 'show' });

    // Wait for bot ready to send payload
    const sendPayload = () => {
      if(window.botpressWebChat.isReady){
        window.botpressWebChat.sendPayload({ type: 'trigger', payload: detail });
        console.log("Payload sent:", detail);
      } else {
        setTimeout(sendPayload, 50);
      }
    };
    sendPayload();
  });
</script>

</body>
</html>
