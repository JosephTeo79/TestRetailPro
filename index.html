<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Botpress Botbassador Demo</title>
<style>
body { font-family: Arial; padding: 2rem; background:#f4f4f4; color:#333; }
#myform { max-width:600px; margin:0 auto; padding:2rem; background:#fff; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
input,textarea { width:100%; padding:0.5rem; margin-bottom:1rem; border:1px solid #ddd; border-radius:5px;}
button { background:#007BFF;color:white;padding:0.7rem 1.5rem;border:none;border-radius:5px;cursor:pointer;}
button:hover { background:#0056b3;}
</style>
</head>
<body>

<h1>Botpress Botbassador Demo</h1>
<form id="myform">
  <label>Name:</label><input type="text" id="name" name="name" required>
  <label>Email:</label><input type="email" id="email" name="email" required>
  <label>LinkedIn:</label><input type="text" id="linkedin" name="linkedin" required>
  <label>Message:</label><textarea id="message" name="message" rows="5"></textarea>
  <button type="submit">Submit</button>
</form>

<script src="https://cdn.botpress.cloud/webchat/v3.5/inject.js"></script>
<script>
window.botpressWebChat.init({
  botId: "a513dc7b-a61b-4a0e-b0c2-79292f0f64b8",
  hostUrl: "https://cdn.botpress.cloud/webchat/v3.5",
  messagingUrl: "https://messaging.botpress.cloud",
  clientId: "a77753bd-2319-48dd-a782-9d6ba282b204",
  hideWidget: true,
  lazySocket: true,
  useSessionStorage: true
});

let botReady = false;
window.botpressWebChat.isReady = false;
window.botpressWebChat.onEvent((event) => {
  if(event.type === 'LIFECYCLE.READY'){
    window.botpressWebChat.isReady = true;
    botReady = true;
    console.log('Botpress Ready');
  }
});

document.getElementById('myform').addEventListener('submit', function(e){
  e.preventDefault();
  const detail = {
    name: this.name.value,
    email: this.email.value,
    linkedin: this.linkedin.value,
    message: this.message.value,
    position: "Botbassador"
  };
  // 展示聊天窗口
  window.botpressWebChat.sendEvent({ type:'show' });

  // 等待 bot ready 再发送 payload
  const sendPayload = () => {
    if(window.botpressWebChat.isReady){
      window.botpressWebChat.sendPayload({ type:'trigger', payload: detail });
      console.log("Payload sent:", detail);
    } else {
      setTimeout(sendPayload, 50);
    }
  };
  sendPayload();
});
</script>

</body>
</html>
