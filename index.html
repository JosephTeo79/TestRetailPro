<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Retail Pro Prism - SubMain Trigger</title>
<style>
  #bot-button {
    position: fixed;
    bottom: 90px;
    right: 20px;
    z-index: 1000;
    background: #007bff;
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    font-size: 24px;
    cursor: pointer;
  }
  #bot-iframe {
    position: fixed;
    bottom: 160px;
    right: 20px;
    width: 400px;
    height: 500px;
    border: 1px solid #ccc;
    border-radius: 8px;
    display: none;
    z-index: 999;
  }
</style>
</head>
<body>

<button id="bot-button">ğŸ’¬</button>
<iframe id="bot-iframe"></iframe>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const botButton = document.getElementById('bot-button');
  const botIframe = document.getElementById('bot-iframe');
  let botLoaded = false;

  // ç”¨æˆ·ä¿¡æ¯
  const userInfo = {
    name: 'Joseph Teo',
    email: 'hai2022my@gmail.com',
    linkedin: 'https://linkedin.com/in/josephteo',
    message: 'Hello from SubMain'
  };

  // Botpress shareable URL
  function buildBotUrl() {
    return 'https://cdn.botpress.cloud/webchat/v3.5/shareable.html' +
           '?configUrl=https://files.bpcontent.cloud/2025/12/22/00/20251222001942-XSX123E9.json';
  }

  // æ‰“å¼€ Bot å¹¶è§¦å‘ trigger
  function openBotAndTrigger() {
    if (!botLoaded) {
      botIframe.src = buildBotUrl();
      botLoaded = true;
    }
    botIframe.style.display = 'block';

    // ç­‰ iframe åŠ è½½å®Œæˆåå‘é€ trigger
    botIframe.onload = function() {
      botIframe.contentWindow.postMessage({
        type: 'trigger',
        name: 'submain_form',    // è¿™é‡Œæ˜¯ä½ åœ¨ Botpress Studio å®šä¹‰çš„ trigger
        payload: userInfo        // ä¼ å…¥ç”¨æˆ·ä¿¡æ¯
      }, '*');
    };
  }

  // ç‚¹å‡»æŒ‰é’®è§¦å‘
  botButton.addEventListener('click', openBotAndTrigger);

  // å¦‚æœæœ‰è¡¨å•ï¼Œæäº¤æ—¶ç›´æ¥è§¦å‘
  /*
  const form = document.getElementById('submain-form');
  form?.addEventListener('submit', function(e){
    e.preventDefault();
    userInfo.name = form.name.value;
    userInfo.email = form.email.value;
    userInfo.linkedin = form.linkedin.value;
    userInfo.message = form.message.value;
    openBotAndTrigger();
  });
  */

});
</script>

</body>
</html>
